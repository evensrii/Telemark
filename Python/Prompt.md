

Based on the current versions of "github_functions.py", "email_when_run_complete.py" and "scheduled_scripts.bat", I want do do the following.

The current code already looks for differences in the generated data and the data on Github. New data (not preexisting on Github) or updated data (different from github) are pushed to Github, while unchanged data are not. This is clearly communicated in the output.

In case of any updates, I want to get a short preview (5 examples) of the actual changes. When the dataset is completely new, I just need that message, and no further details.

We should check for differences in the following order:

STEP 1: Check header changes
First check for structural changes in headers (ignoring case, "andel" and "Andel" is the same)
Then check for year changes in part of headers (like "Andel 2023" to "Andel 2024")
Return immediately if any header changes, and report that. Tell me which headers changed.

STEP 2: Check row count
Only runs if no header changes were found
Compares the number of rows between old and new data
Return immediately if row count has changed, and report that. Tell me the number of lines in the old and new data.

STEP 3: Check value changes
Only runs if both headers and row counts are identical
Compares the actual data values for changes
Return if any data values have changed, and give 5 examples of differences

Each step has its own clear exit point (return True) if changes are detected, ensuring that we handle changes in order of significance:

Header changes are most significant (structural changes to the data)
Row count changes are next most significant (data size changes)
Value changes are checked last (changes within existing structure)

Sometimes, the dataset are quite large. Make sure to report whether they are new, updated or same as before, as I describe above. However, to make sure the detailed comparisons dont take too much time and memory, only look for differences to report in the final 200 lines. In such cases, differences may be detected (and the data uploaded to Github), but no differences will be previewed (if there are none in the last 200 lines).

I guess it is important do identify key columns and numerical columns. Columns named "Kommunenummer", "kommunenummer", "Kommunenr" or "kommunenr" can be treated as categorical, and ignored in search of value differences.

Any changes in dates is treated as a difference. For comparisons sake, you can convert all dates to the same format, but the final format (i.e. 2023 or 2023-01-01) has to stay untouched.

Make sure the Norwegian letters like "Æ", "Ø" and "Å" (in both small and capital versions) is not causing problems in comparisons. Keep as is, and convert to UTF-8.

All logging should be done to the individual log files generated by the "scheduled_scripts.bat". Add timestamps in the log files.

The Github details, as API end point, file paths, repo name, file handling etc. is fine, dont mess too much with those.

Deletion of temporary files is done in the individual scripts, and does not have to be handled in any other functions.

I suggest we start by addressing STEP 1 above.

Ask me if anything is unclear.